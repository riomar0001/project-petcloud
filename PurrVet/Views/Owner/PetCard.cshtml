@model PurrVet.Models.PetCardVM
@{
    Layout = "~/Views/Shared/_DashboardLayoutModern.cshtml";
    ViewBag.Title = "Pets";

    var fallback = Url.Content("~/uploads/profiles/pet.png");
    var photoPath = string.IsNullOrEmpty(Model.Pet.PhotoPath) ? fallback : Url.Content(Model.Pet.PhotoPath);
    int maxPagesToShow = 5;
    int blockSize = 10;
    int startPage = Math.Max(1, Model.CurrentPage - 2);
    int endPage = Math.Min(Model.TotalPages, Model.CurrentPage + 2);
}

<div class="d-flex justify-content-between align-items-center p-2 flex-wrap">

    <div class="d-flex flex-wrap justify-content-end justify-content-md-end gap-2 w-100 w-md-auto mt-md-0">
        <a href="@Url.Action("ViewPet", "Owner", new { id = Model.Pet.PetID })"
           class="btn btn-warning fw-semibold" style="background:#FFB100;border:none;">
            ?? Pet Info
        </a>

        <a class="btn fw-semibold" style="background:#559DD4;border:none;color:white;">
            ?? Pet Card
        </a>

        <button onclick="printPetCard()" class="btn btn-dark fw-semibold">??? Print</button>

        <a href="@Url.Action("DownloadPetCardPdf", "Owner", new { id = Model.Pet.PetID })"
           class="btn btn-secondary fw-semibold">?? PDF</a>
    </div>
</div>

<div class="p-3">

    <div class="card shadow-sm border-0 no-print p-3 mb-3">
        <div class="d-flex align-items-center">
            <img src="@photoPath" class="rounded-circle me-3 shadow-sm" style="width:90px;height:90px;object-fit:cover;" />
            <div>
                <h5 class="fw-bold mb-1">@Model.Pet.Name</h5>
                <div class="text-muted small">
                    Breed: @Model.Pet.Breed | Type: @Model.Pet.Type | Age: @Model.AgeInMonths month/s
                </div>
            </div>
        </div>
    </div>

    <div id="printArea" class="shadow-sm p-3 bg-white border">
        <div class="d-none d-print-block mb-3">

            <div class="row">
                <div class="col-8">
                    <h6 class="fw-bold mb-1">Pet Information</h6>
                    <p><strong>Name:</strong> @Model.Pet.Name</p>
                    <p><strong>Species:</strong> @Model.Pet.Type</p>
                    <p><strong>Breed:</strong> @Model.Pet.Breed</p>
                    <p><strong>Birthdate:</strong> @Model.Pet.Birthdate.ToString("MMM dd, yyyy")</p>
                    <p><strong>Pet ID:</strong> @Model.Pet.PetID.ToString("D6")</p>

                    <h6 class="fw-bold mt-2 mb-1">Owner Information</h6>
                    <p><strong>Name:</strong> @Model.Pet.Owner.Name</p>
                    <p><strong>Contact:</strong> @Model.Pet.Owner.Phone</p>
                    <p><strong>Email:</strong> @Model.Pet.Owner.Email</p>
                </div>

                <div class="col-4 text-center">
                    <div class="border" style="height:160px;display:flex;align-items:center;justify-content:center;">
                        <img src="@photoPath" style="max-width:100%;max-height:155px;object-fit:cover;" />
                    </div>

                    <small></small>
                </div>
            </div>

            <hr class="border-dark" />
        </div>

        <div class="d-flex align-items-center mb-2 print-hide">
            <img src="~/images/happypawslogo.jpg" style="width:80px;" class="me-2" />
            <div class="text-center flex-grow-1">
                <h4 class="fw-bold mb-0">Happy Paws Veterinary Clinic</h4>
                <h6 class="fw-bold mt-0">Pet Health Card</h6>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-bordered text-center" style="table-layout: fixed; width: 100%;">
                <colgroup>
                    <col style="width:16%;">
                    <col style="width:13%;">
                    <col style="width:22%;">
                    <col style="width:22%;">
                    <col style="width:15%;">
                    <col style="width:15%;">
                </colgroup>

                <thead class="table-light">
                    <tr>
                        <th>Date</th>
                        <th>Wt.</th>
                        <th>Vaccination</th>
                        <th>Ecto & Endo</th>
                        <th>Veterinarian</th>
                        <th>Next</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var r in Model.PageData)
                    {
                        <tr>
                            <td>@r.AppointmentDate.ToString("MM/dd/yyyy")</td>
                            <td>@r.Notes?.Split("|")?[0]</td>
                            @if (r.ServiceCategory?.ServiceType == "Vaccination")
                            {
                                <td>@r.ServiceSubtype?.ServiceSubType</td>
                            }
                            else
                            {
                                <td>Not Availed</td>
                            }
                            @if (r.ServiceCategory?.ServiceType == "Deworming & Preventives")
                            {
                                <td>@r.ServiceSubtype?.ServiceSubType</td>
                            }
                            else
                            {
                                <td>Not Availed</td>
                            }
                            <td>@r.AdministeredBy</td>
                            <td>@r.DueDate?.ToString("MM/dd/yyyy")</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <nav class="mt-3 no-print">
        <ul class="pagination justify-content-center mb-0">

            <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
                <a class="page-link border-0 text-dark"
                   href="@(Model.CurrentPage == 1 ? "#" : $"?id={Model.Pet.PetID}&page={Model.CurrentPage - 1}")">‹</a>
            </li>

            @if (startPage > 1)
            {
                <li class="page-item">
                    <a class="page-link rounded-circle border-0 text-dark"
                       style="width:32px;height:32px;display:flex;align-items:center;justify-content:center;"
                       href="?id=@Model.Pet.PetID&page=1">1</a>
                </li>

                <li class="page-item">
                    <a class="page-link border-0 text-dark fw-bold"
                       href="?id=@Model.Pet.PetID&page=@(Math.Max(1, Model.CurrentPage - blockSize))">...</a>
                </li>
            }

            @for (int i = startPage; i <= endPage; i++)
            {
                if (i == Model.CurrentPage)
                {
                    <li class="page-item active">
                        <a class="page-link rounded-circle border-0 text-black"
                           style="background-color:var(--primary-green, #10B981);width:32px;height:32px;display:flex;align-items:center;justify-content:center;">@i</a>
                    </li>
                }
                else
                {
                    <li class="page-item">
                        <a class="page-link rounded-circle border-0 text-dark"
                           style="width:32px;height:32px;display:flex;align-items:center;justify-content:center;"
                           href="?id=@Model.Pet.PetID&page=@i">@i</a>
                    </li>
                }
            }

            @if (endPage < Model.TotalPages)
            {
                <li class="page-item">
                    <a class="page-link border-0 text-dark fw-bold"
                       href="?id=@Model.Pet.PetID&page=@(Math.Min(Model.TotalPages, Model.CurrentPage + blockSize))">...</a>
                </li>

                <li class="page-item">
                    <a class="page-link rounded-circle border-0 text-dark"
                       style="width:32px;height:32px;display:flex;align-items:center;justify-content:center;"
                       href="?id=@Model.Pet.PetID&page=@Model.TotalPages">@Model.TotalPages</a>
                </li>
            }

            <li class="page-item @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")">
                <a class="page-link border-0 text-dark"
                   href="@(Model.CurrentPage == Model.TotalPages ? "#" : $"?id={Model.Pet.PetID}&page={Model.CurrentPage + 1}")">›</a>
            </li>

        </ul>
    </nav>

    <div class="row text-center mt-4 no-print">

        <div class="col-md-4 mb-2">
            <div style="background:#559DD4;color:white;padding:6px;border-radius:8px 8px 0 0;">
                <strong>Recommended Vaccination for DOGS</strong>
            </div>
            <div class="card-equal" style="background:white;border:2px solid #559DD4;border-top:0;border-radius:0 0 8px 8px;padding:8px;">
                Distemper, Parvo, Lepto<br>
                Rabies at 12 weeks<br>
                Annually
            </div>
        </div>

        <div class="col-md-4 mb-2">
            <div style="background:#C38AC7;color:white;padding:6px;border-radius:8px 8px 0 0;">
                <strong>Recommended Ecto & Endo Parasitic Treatment</strong>
            </div>
            <div class="card-equal" style="background:white;border:2px solid #C38AC7;border-top:0;border-radius:0 0 8px 8px;padding:8px;">
                Every 2 weeks × 2<br>
                Then every 3 months
            </div>
        </div>

        <div class="col-md-4 mb-2">
            <div style="background:#E5A43B;color:white;padding:6px;border-radius:8px 8px 0 0;">
                <strong>Recommended Vaccination for CATS</strong>
            </div>
            <div class="card-equal" style="background:white;border:2px solid #E5A43B;border-top:0;border-radius:0 0 8px 8px;padding:8px;">
                FPV / FHV / FCV<br>
                Rabies<br>
                Annually
            </div>
        </div>

    </div>

</div>

<script>
function printPetCard() {
    window.print();
}
</script>
