@model PurrVet.Models.PetCardVM
@{
    Layout = "~/Views/Shared/_DashboardLayoutModern.cshtml";
    ViewBag.Title = "Pets";

    var fallback = Url.Content("~/uploads/profiles/pet.png");
    var photoPath = string.IsNullOrEmpty(Model.Pet.PhotoPath) ? fallback : Url.Content(Model.Pet.PhotoPath);
    int maxPagesToShow = 5;
    int blockSize = 10;
    int startPage = Math.Max(1, Model.CurrentPage - 2);
    int endPage = Math.Min(Model.TotalPages, Model.CurrentPage + 2);
    var petTypeIcon = Model.Pet.Type == "Dog" ? "üêï" : Model.Pet.Type == "Cat" ? "üêà" : "üêæ";
}

<!-- Dashboard Header -->
<div class="dashboard-header">
    <h2><i class="bi bi-card-checklist"></i>Pet Health Card</h2>
    <p>View and print pet health records for @Model.Pet.Name</p>
</div>

<!-- Breadcrumb -->
<div class="breadcrumb-modern mb-4 no-print">
    <a href="@Url.Action("Pets", "Staff")"><i class="bi bi-grid me-1"></i>All Pets</a>
    <span class="separator">/</span>
    <a href="@Url.Action("ViewPet", "Staff", new { id = Model.Pet.PetID })">@Model.Pet.Name</a>
    <span class="separator">/</span>
    <span class="current">Health Card</span>
</div>

<!-- Navigation Pills -->
<div class="filter-bar-modern mb-4 no-print">
    <div class="d-flex align-items-center gap-2">
        <a href="@Url.Action("ViewPet", "Staff", new { id = Model.Pet.PetID })"
           class="btn-modern-secondary">
            <i class="bi bi-info-circle me-1"></i> Pet Info
        </a>
        <a class="btn-modern-primary">
            <i class="bi bi-card-heading me-1"></i> Pet Card
        </a>
    </div>
    <div class="d-flex align-items-center gap-2">
        <button onclick="printPetCard()" class="btn-modern-secondary">
            <i class="bi bi-printer me-1"></i> Print
        </button>
        <a href="@Url.Action("DownloadPetCardPdf", "Staff", new { id = Model.Pet.PetID })"
           class="btn-modern-danger">
            <i class="bi bi-file-earmark-pdf me-1"></i> PDF
        </a>
    </div>
</div>

<!-- Pet Summary Card -->
<div class="page-card-modern no-print">
    <div class="card-header-modern">
        <h6><i class="bi bi-heart-pulse me-2"></i>PET SUMMARY</h6>
    </div>
    <div class="card-body p-4">
        <div class="d-flex align-items-center">
            <div class="pet-profile-preview" style="width: auto;">
                <img src="@photoPath" style="width: 100px; height: 100px;"
                     onerror="this.onerror=null;this.src='@fallback';" />
            </div>
            <div class="ms-4">
                <h4 class="fw-bold mb-2">@Model.Pet.Name</h4>
                <div class="d-flex flex-wrap gap-2">
                    <span class="badge-modern badge-type-pet">@petTypeIcon @Model.Pet.Type</span>
                    <span class="badge-modern badge-type-appointment">@Model.Pet.Breed</span>
                    <span class="badge-modern badge-pending">@Model.AgeInMonths month(s) old</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Health Card Table -->
<div class="page-card-modern">
    <div id="printArea" class="p-3 bg-white">
        <div class="d-none d-print-block mb-3">
            <div class="row">
                <div class="col-8">
                    <h6 class="fw-bold mb-1">Pet Information</h6>
                    <p><strong>Name:</strong> @Model.Pet.Name</p>
                    <p><strong>Species:</strong> @Model.Pet.Type</p>
                    <p><strong>Breed:</strong> @Model.Pet.Breed</p>
                    <p><strong>Birthdate:</strong> @Model.Pet.Birthdate.ToString("MMM dd, yyyy")</p>
                    <p><strong>Pet ID:</strong> @Model.Pet.PetID.ToString("D6")</p>

                    <h6 class="fw-bold mt-2 mb-1">Owner Information</h6>
                    <p><strong>Name:</strong> @Model.Pet.Owner.Name</p>
                    <p><strong>Contact:</strong> @Model.Pet.Owner.Phone</p>
                    <p><strong>Email:</strong> @Model.Pet.Owner.Email</p>
                </div>
                <div class="col-4 text-center">
                    <div class="border" style="height:160px;display:flex;align-items:center;justify-content:center;">
                        <img src="@photoPath" style="max-width:100%;max-height:155px;object-fit:cover;" />
                    </div>
                    <small></small>
                </div>
            </div>
            <hr class="border-dark" />
        </div>

        <div class="d-flex align-items-center mb-2 print-hide">
            <img src="~/images/happypawslogo.jpg" style="width:80px;" class="me-2" />
            <div class="text-center flex-grow-1">
                <h4 class="fw-bold mb-0">Happy Paws Veterinary Clinic</h4>
                <h6 class="fw-bold mt-0">Pet Health Card</h6>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table-modern-list" style="table-layout: fixed; width: 100%;">
                <colgroup>
                    <col style="width:16%;">
                    <col style="width:13%;">
                    <col style="width:22%;">
                    <col style="width:22%;">
                    <col style="width:15%;">
                    <col style="width:15%;">
                </colgroup>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Wt.</th>
                        <th>Vaccination</th>
                        <th>Ecto & Endo</th>
                        <th>Veterinarian</th>
                        <th>Next</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var r in Model.PageData)
                    {
                        <tr>
                            <td>@r.AppointmentDate.ToString("MM/dd/yyyy")</td>
                            <td>@r.Notes?.Split("|")?[0]</td>
                            @if (r.ServiceCategory?.ServiceType == "Vaccination")
                            {
                                <td>@r.ServiceSubtype?.ServiceSubType</td>
                            }
                            else
                            {
                                <td>Not Availed</td>
                            }
                            @if (r.ServiceCategory?.ServiceType == "Deworming & Preventives")
                            {
                                <td>@r.ServiceSubtype?.ServiceSubType</td>
                            }
                            else
                            {
                                <td>Not Availed</td>
                            }
                            <td>@r.AdministeredBy</td>
                            <td>@r.DueDate?.ToString("MM/dd/yyyy")</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Pagination -->
<nav class="pagination-modern no-print">
    <ul class="pagination mb-0">
        <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
            <a class="page-link"
               href="@(Model.CurrentPage == 1 ? "#" : $"?id={Model.Pet.PetID}&page={Model.CurrentPage - 1}")">
                <i class="bi bi-chevron-left"></i>
            </a>
        </li>

        @if (startPage > 1)
        {
            <li class="page-item">
                <a class="page-link" href="?id=@Model.Pet.PetID&page=1">1</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?id=@Model.Pet.PetID&page=@(Math.Max(1, Model.CurrentPage - blockSize))">...</a>
            </li>
        }

        @for (int i = startPage; i <= endPage; i++)
        {
            <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                <a class="page-link" href="?id=@Model.Pet.PetID&page=@i">@i</a>
            </li>
        }

        @if (endPage < Model.TotalPages)
        {
            <li class="page-item">
                <a class="page-link" href="?id=@Model.Pet.PetID&page=@(Math.Min(Model.TotalPages, Model.CurrentPage + blockSize))">...</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?id=@Model.Pet.PetID&page=@Model.TotalPages">@Model.TotalPages</a>
            </li>
        }

        <li class="page-item @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")">
            <a class="page-link"
               href="@(Model.CurrentPage == Model.TotalPages ? "#" : $"?id={Model.Pet.PetID}&page={Model.CurrentPage + 1}")">
                <i class="bi bi-chevron-right"></i>
            </a>
        </li>
    </ul>
</nav>

<!-- Recommendation Cards -->
<div style="padding: 0 24px 24px;" class="no-print">
    <div class="row text-center mt-4">
        <div class="col-md-4 mb-2">
            <div style="background:#10B981;color:white;padding:6px;border-radius:8px 8px 0 0;">
                <strong>Recommended Vaccination for DOGS</strong>
            </div>
            <div class="card-equal" style="background:white;border:2px solid #10B981;border-top:0;border-radius:0 0 8px 8px;padding:8px;">
                Distemper, Parvo, Lepto<br>
                Rabies at 12 weeks<br>
                Annually
            </div>
        </div>

        <div class="col-md-4 mb-2">
            <div style="background:#8B5CF6;color:white;padding:6px;border-radius:8px 8px 0 0;">
                <strong>Recommended Ecto & Endo Parasitic Treatment</strong>
            </div>
            <div class="card-equal" style="background:white;border:2px solid #8B5CF6;border-top:0;border-radius:0 0 8px 8px;padding:8px;">
                Every 2 weeks x 2<br>
                Then every 3 months
            </div>
        </div>

        <div class="col-md-4 mb-2">
            <div style="background:#F59E0B;color:white;padding:6px;border-radius:8px 8px 0 0;">
                <strong>Recommended Vaccination for CATS</strong>
            </div>
            <div class="card-equal" style="background:white;border:2px solid #F59E0B;border-top:0;border-radius:0 0 8px 8px;padding:8px;">
                FPV / FHV / FCV<br>
                Rabies<br>
                Annually
            </div>
        </div>
    </div>
</div>

<script>
function printPetCard() {
    window.print();
}
</script>
