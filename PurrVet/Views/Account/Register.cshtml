@model PurrVet.Models.User

@{
    ViewBag.Title = "Register";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="hero-section d-flex flex-column justify-content-center">
    <div class="hero-wave"></div>

    <div class="container">
        <div class="row align-items-center justify-content-center text-center text-md-start">
            <div class="col-md-3 mb-4 mb-md-0 slogan-col">
                <h1 class="fw-bold slogan">Healthy Pets,<br />Happy Homes.</h1>
            </div>

            <div class="col-md-2 mb-4 mb-md-0 paws-col d-flex justify-content-center">
                <img src="~/images/paws.png" alt="Paws" class="reg-paws" />
            </div>

            <div class="col-md-5 d-flex justify-content-end">
                <div class="login-card shadow p-4 w-100" style="max-width: 400px;">

                    <div class="position-fixed top-0 end-0 p-3" style="z-index: 1055">
                        <div id="messageToast" class="toast align-items-center text-white border-0">
                            <div class="d-flex">
                                <div class="toast-body"></div>
                                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                            </div>
                        </div>
                    </div>

                    <h6 class="mb-3 text-center fw-bold">Create your account to get started.</h6>
                    <hr class="mb-4">

                    <form id="registerForm">
                        @Html.AntiForgeryToken()

                        <h6 class="fw-bold text-start mb-3">Create Account</h6>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <input type="text" class="form-control" name="firstname" placeholder="First Name" required />
                            </div>
                            <div class="col-md-6 mb-3">
                                <input type="text" class="form-control" name="lastname" placeholder="Last Name" required />
                            </div>
                        </div>

                        <div class="mb-3">
                            <input type="email" class="form-control" name="email" placeholder="Email" required />
                        </div>

                        <div class="mb-3">
                            <input type="tel"
                                   name="Phone"
                                   id="Phone"
                                   class="form-control"
                                   placeholder="e.g. 09123456789"
                                   inputmode="numeric"
                                   pattern="[0-9]{11}"
                                   minlength="11"
                                   maxlength="11"
                                   required />                       
                        </div>

                        <div class="mb-3 position-relative">
                            <input type="password" class="form-control" name="password" id="regPassword" placeholder="Password" required />
                            <span id="toggleRegPassword"
                                  class="position-absolute top-50 end-0 translate-middle-y me-3"
                                  style="cursor:pointer; font-size:12px; color:#666;">
                                <i id="eyeIcon" class="fa-solid fa-eye"></i>
                            </span>
                        </div>

                        <div class="mb-3 position-relative">
                            <input type="password" class="form-control" name="confirmpassword" id="regConfirmPassword" placeholder="Confirm Password" required />
                            <span id="toggleRegConfirmPassword"
                                  class="position-absolute top-50 end-0 translate-middle-y me-3"
                                  style="cursor:pointer; font-size:12px; color:#666;">
                                <i id="eyeIcon" class="fa-solid fa-eye"></i>
                            </span>
                        </div>

                        <div class="mb-3 form-check text-start">
                            <input type="checkbox" class="form-check-input" required />
                            <label class="form-check-label small">
                                I agree to the <a href="#">Terms</a> and <a href="#">Privacy Policy</a>
                            </label>
                        </div>

                        <button type="submit" class="btn-skyblue w-100">Sign Up</button>

                    </form>

                </div>
            </div>
        </div>
    </div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        document.getElementById("Phone").addEventListener("input", function () {
            this.value = this.value.replace(/\D/g, '');

            if (this.value.length > 11) {
                this.value = this.value.slice(0, 11);
            }
        });
        $(document).ready(function () {

            const toastEl = $('#messageToast');
            const toastBody = toastEl.find('.toast-body');

            function showToast(msg, success = false) {
                toastBody.text(msg);
                toastEl.removeClass('bg-success bg-danger')
                       .addClass(success ? 'bg-success' : 'bg-danger');
                new bootstrap.Toast(toastEl[0], { delay: 3000 }).show();
            }

            $("#toggleRegPassword").click(function () {
                const f = $("#regPassword");
                const i = $(this).find("i");
                const hidden = f.attr("type") === "password";
                f.attr("type", hidden ? "text" : "password");
                i.toggleClass("fa-eye fa-eye-slash");
            });

            $("#toggleRegConfirmPassword").click(function () {
                const f = $("#regConfirmPassword");
                const i = $(this).find("i");
                const hidden = f.attr("type") === "password";
                f.attr("type", hidden ? "text" : "password");
                i.toggleClass("fa-eye fa-eye-slash");
            });

            $('#registerForm').submit(function (e) {
                e.preventDefault();

                const pass = $("#regPassword").val();
                const confirm = $("#regConfirmPassword").val();

                if (pass !== confirm) {
                    showToast("Passwords do not match.");
                    return;
                }

                $.ajax({
                    url: '@Url.Action("Register")',
                    type: 'POST',
                    data: $(this).serialize(),
                    success: function (res) {
                        showToast(res.message, res.success);

                        if (res.success) {
                            $('#registerForm')[0].reset();
                            setTimeout(() => window.location.href = '/Account/Login', 1500);
                        }
                    },
                    error: function () {
                        showToast("Unexpected error occurred.");
                    }
                });
            });

        });

    </script>
}
